<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Website Blocked</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');
    body {
      background-image: url('Indonesin Danger.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }
    .blocked-overlay {
      position: fixed;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,0.85);
      z-index:9999;
      color: white;
      text-align:center;
      padding: 2rem;
    }
  </style>
</head>
<body class="bg-[#6a3f44] font-['Roboto'] flex flex-col items-center justify-start min-h-screen p-4">
  <div class="max-w-md w-full text-center text-white select-none px-4 sm:px-6">
    <img alt="KOMINFO logo" class="mx-auto mb-6 rounded-md" height="80" src="Komdigi.png" width="80"/>
    <h1 class="text-3xl font-extrabold mb-2 leading-tight">SITUS DIBLOKIR</h1>
    <h2 class="text-xl font-extrabold italic mb-6">WEBSITE BLOCKED</h2>
    <p class="text-base font-bold leading-snug mb-2">
      UNDANG-UNDANG NOMOR 19 TAHUN 2016 PASAL 40 (2a) dan (2b)
    </p>
    <p class="text-sm font-normal mb-8 leading-tight">
      MAAF, AKSES KE SITUS INI DIBLOKIR OLEH PEMERINTAH INDONESIA
      <br/>KARENA MENGANDUNG KONTEN YANG MELANGGAR PERATURAN
    </p>
    <button id="btn-check" class="text-white font-bold text-base px-6 py-2 rounded-md border border-red-500 bg-[#7a8a9a] shadow-[0_0_6px_2px_rgba(255,0,0,0.5)] hover:bg-[#6a7a8a] transition">
      CHECK DATABASE TRUSTPOSITIF
    </button>
    <p id="status-msg" class="text-xs mt-3 opacity-70"></p>
  </div>

  <!-- overlay tampilan blokir jika terdeteksi -->
  <div id="blockOverlay" class="blocked-overlay" style="display:none">
    <div>
      <h2 style="font-size:24px;margin-bottom:.5rem">AKSES DITOLAK</h2>
      <p id="blockReason" style="margin-bottom:1rem">Alasan: —</p>
      <button onclick="location.reload()" class="px-4 py-2 rounded bg-white text-black">Muat ulang</button>
    </div>
  </div>

<script>
/*
  Versi offline (heuristik) fitur:
  1. Anti ubah jam: menggunakan performance.now() (monotonic). Sangat andal untuk mendeteksi manipulasi jam lokal.
  2. Anti timezone tamper / DNS custom / proxy heuristik:
     - Bandingkan timezone offset & Intl.timeZone dengan bahasa/perkiraan locale.
     - Monitor perubahan offset timezone setelah beberapa detik.
     - Cek navigator.connection (jika tersedia) untuk anomali (effectiveType "unknown", downlink 0).
     - Gunakan WebRTC (lokal-only) untuk mendapatkan alamat IP lokal (tidak memerlukan layanan eksternal).
     - Jika WebRTC public IP dibutuhkan, itu memerlukan STUN (eksternal) — tidak dipakai di mode offline.
  3. Blocking: tampilkan overlay dan hentikan interaksi.
*/

(function(){
  // KONFIGURASI
  const TIME_DIFF_THRESHOLD_MINUTES = 3; // jika selisih offset berubah lebih dari X menit => blokir
  const TIME_JUMP_THRESHOLD_MINUTES = 3; // jika jam melompat lebih dari X menit => blokir
  const TZ_MISMATCH_SCORE_THRESHOLD = 2; // skor heuristik untuk timezone/lang mismatch => blokir

  // UI helpers
  const overlay = document.getElementById('blockOverlay');
  const blockReason = document.getElementById('blockReason');
  const statusMsg = document.getElementById('status-msg');
  const btnCheck = document.getElementById('btn-check');

  function block(reason){
    blockReason.textContent = reason;
    overlay.style.display = 'flex';
    console.warn('[SEC BLOCK]', reason);
  }

  // ---------- ANTI UBAH JAM (monotonic) ----------
  // Baseline offset between Date.now() (wall clock) and performance.now() (monotonic)
  const baseline = {
    tsNow: Date.now(),
    perfNow: performance.now(),
    tzOffsetMinutes: new Date().getTimezoneOffset() // minutes
  };

  // helper: compute current offset
  function currentOffset() {
    return {
      tsNow: Date.now(),
      perfNow: performance.now(),
      computedOffsetMs: Date.now() - performance.now()
    };
  }

  // check function executed periodically
  function checkClockTamper(){
    try {
      const cur = currentOffset();
      const baselineOffset = baseline.tsNow - baseline.perfNow; // ms
      const curOffset = cur.tsNow - cur.perfNow; // ms
      const deltaMs = Math.abs(curOffset - baselineOffset);
      const deltaMinutes = deltaMs / 1000 / 60;

      // detect large change in system clock relative to monotonic clock
      if (deltaMinutes > TIME_JUMP_THRESHOLD_MINUTES) {
        block('Waktu perangkat (jam) dimanipulasi atau terjadi perubahan besar pada jam sistem.');
        return true;
      }

      // detect timezone offset change (user ubah timezone)
      const curTz = new Date().getTimezoneOffset();
      if (curTz !== baseline.tzOffsetMinutes) {
        const tzDiffMinutes = Math.abs(curTz - baseline.tzOffsetMinutes);
        if (tzDiffMinutes > TIME_DIFF_THRESHOLD_MINUTES) {
          block('Timezone/perangkat waktu diubah secara tidak wajar.');
          return true;
        }
      }
      return false;
    } catch (e) {
      console.error('checkClockTamper failed', e);
      return false;
    }
  }

  // ---------- HEURISTIK JARINGAN OFFLINE (VPN/Proxy/DNS) ----------
  function scoreNetworkHeuristics() {
    let score = 0;
    let reasons = [];

    // 1) Timezone vs language heuristic
    try {
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'unknown';
      const lang = navigator.language || navigator.userLanguage || 'unknown';
      // contoh heuristik sederhana: jika timezone "UTC" tetapi bahasa default ID/IDN, curiga
      if (tz === 'UTC' && /^id|^en-?US/i.test(lang) === false) {
        score += 1;
        reasons.push('Timezone tampak generik (UTC) sementara pengaturan bahasa tidak konsisten.');
      }
      // jika timezone bukan ditemukan (browser tidak support), beri 1 poin
      if (tz === 'unknown') {
        score += 1;
        reasons.push('Timezone tidak tersedia dari browser.');
      }
    } catch(e){ /* ignore */ }

    // 2) navigator.connection (jika tersedia)
    try {
      const nc = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      if (nc) {
        // effectiveType "unknown" atau downlink 0 dianggap anomali
        if (nc.effectiveType === 'unknown' || nc.downlink === 0) {
          score += 1;
          reasons.push('Informasi koneksi aneh (effectiveType/downlink).');
        }
      }
    } catch(e){ /* ignore */ }

    // 3) Browser fingerprint anomalies (simple)
    try {
      // Jika userAgent berisi kata "Pragma: no-cache" atau "Proxy" -> curiga
      const ua = navigator.userAgent || '';
      if (/:\s*no-cache|Proxy|curl|Wget/i.test(ua)) {
        score += 2;
        reasons.push('UserAgent mengandung pola yang sering dipakai alat otomatis/proxy.');
      }
    } catch(e){}

    // 4) WebRTC local IP collection (lokal-only) -> jika tidak ada alamat lokal yang umum, beri 1 poin
    // (tidak menggunakan STUN publik; hanya mencatat apakah kita bisa mendapatkan local IP)
    // Note: modern browser mengekang exposure IP; ketiadaan tidak berarti aman.
    // kita jalankan async di luar, jadi untuk sekarang hanya set placeholder.

    return {score, reasons};
  }

  // async helper: coba ambil candidate IP lokal via RTCPeerConnection (tanpa STUN)
  function getLocalIPsViaWebRTC(timeoutMs = 2500){
    return new Promise((resolve) => {
      const ips = new Set();
      try {
        // membuat RTCPeerConnection tanpa ICE servers => hanya local candidates
        const pc = new RTCPeerConnection({iceServers: []});
        // create datachannel supaya canditates muncul
        pc.createDataChannel('diag');
        pc.onicecandidate = (evt) => {
          if (!evt.candidate) return;
          const cand = evt.candidate.candidate;
          // cari pola IP
          const reIp = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
          const m = reIp.exec(cand);
          if (m) ips.add(m[1]);
        };
        pc.createOffer().then(offer => pc.setLocalDescription(offer)).catch(()=>{});
        setTimeout(()=> {
          try { pc.close(); } catch(e){}
          resolve(Array.from(ips));
        }, timeoutMs);
      } catch (e) {
        resolve([]);
      }
    });
  }

  // main offline check
  async function runOfflineChecks(){
    statusMsg.textContent = 'Menjalankan pemeriksaan offline...';
    // 1. clock tamper
    if (checkClockTamper()) return;

    // 2. basic heuristics score
    const heur = scoreNetworkHeuristics();
    // run WebRTC local IP fetch
    const localIPs = await getLocalIPsViaWebRTC();
    if (localIPs.length === 0) {
      // modern browsers might hide local IP => tidak selalu indikasi jahat
      heur.score += 0; // we don't penalize too much
    } else {
      // jika ditemukan local IP yang bukan RFC1918 (private), curiga
      // catatan: biasanya local IP adalah private (10.x.x.x, 192.168.x.x, 172.16-31)
      const privateRe = /^(10\.|192\.168\.|172\.(1[6-9]|2[0-9]|3[0-1]))/;
      let foundNonPrivate = localIPs.some(ip => !privateRe.test(ip));
      if (foundNonPrivate) {
        heur.score += 2;
        heur.reasons.push('Alamat jaringan lokal tampak publik (indikasi tunneling/VPN).');
      }
    }

    // decide
    if (heur.score >= TZ_MISMATCH_SCORE_THRESHOLD) {
      block('Terjadi perilaku jaringan mencurigakan: ' + heur.reasons.join(' • '));
      return;
    }

    statusMsg.textContent = 'Pemeriksaan offline selesai — tidak terdeteksi masalah serius.';
  }

  // periodic clock check
  setInterval(() => {
    if (overlay.style.display === 'flex') return; // jika sudah diblokir skip
    checkClockTamper();
  }, 5000); // cek tiap 5 detik

  // juga cek timezone setiap 10 detik
  setInterval(() => {
    if (overlay.style.display === 'flex') return;
    const curTz = new Date().getTimezoneOffset();
    if (Math.abs(curTz - baseline.tzOffsetMinutes) > TIME_DIFF_THRESHOLD_MINUTES) {
      block('Timezone/perangkat waktu diubah secara tidak wajar.');
    }
  }, 10000);

  // tombol manual untuk menjalankan heuristik offline
  btnCheck.addEventListener('click', () => {
    runOfflineChecks();
  });

  // jalankan langsung sekali saat muat halaman
  runOfflineChecks();

  // OPTIONAL: kalau mau tingkatkan akurasi, aktifkan STUN/lookup geoIP server-side.
  // Namun fitur offline ini sengaja dibuat tanpa panggilan ke API eksternal.
})();
</script>
</body>
</html>